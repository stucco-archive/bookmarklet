<!DOCTYPE html>
<head>
<meta charset="utf-8">
<title>Stucco Relevance / Credibility Study</title>
<meta name="description" content="User study for Stucco project">
<meta name="viewport" content="width=device-width">

<link rel="stylesheet" href="pure.css" />

<script src="components/md5/md5.min.js"></script>

<style>
  body {
    margin: 40px 60px;
    font-size: 18px;
  }
  .container {
    width: 600px;
    margin: 0 auto;
  }
  #initialHide p {
    padding: 10px 0;
  }
  #stuccoId {
    color:#777;
    font-size: 90%;
  }
  #bookmarklet {
    padding: 4px 10px;
    font-size: 16px;
    font-weight: bold;
    text-decoration: none;
    border-radius: 1em;
    background: #777;
    color: white;
  }
  .hidden {
    display: none;
  }
</style>
</head>
<body>

<div class="container">
  <h2>Stucco Relevance / Credibility Study </h2>

<div id="initialHide" class="hidden">
  <p id="stuccoId"></p>

  <p>
    <a id="bookmarklet">Stucco Bookmarklet</a>
    <span id="drag">‚Üê Drag this to your bookmarks bar.</span>
  </p>

  <br /><br />

  <h3>Directly Submit URLs</h3>

  <div id="backupForm">
  <form class='pure-form'>

  <legend>Submit URLs directly without using bookmarklet.</legend>

  <fieldset>
    <div class="label-block">
      <label for="document-url">Enter the document url:</label>
    </div>
    <input type="text" id="url" name="document-url" class="pure-input-1" placeholder="http://example.com/" required>
  </fieldset>

  <fieldset>
    <div class="label-block"><label for="relevance2">How relevant is this document to cyber security?</label></div>
    Not Relevant
    <input class="ranking" type="radio" name="relevance2" value="1" required>
    <input class="ranking" type="radio" name="relevance2" value="2" required>
    <input class="ranking" type="radio" name="relevance2" value="3" required>
    <input class="ranking" type="radio" name="relevance2" value="4" required>
    <input class="ranking" type="radio" name="relevance2" value="5" required>
    Very Relevant
  </fieldset>

  <fieldset>
    <div class="label-block"><label for="concept2">Which, if any, domain concepts are described in this document?</label></div>
    <input class="categorical" type="checkbox" name="concept2" value="vulnerability" > vulnerability
    <input class="categorical" type="checkbox" name="concept2" value="exploit" > exploit
    <input class="categorical" type="checkbox" name="concept2" value="malware" > malware
    <input class="categorical" type="checkbox" name="concept2" value="attack" > attack
    <input class="categorical" type="checkbox" name="concept2" value="attacker" > attacker
  </fieldset>

  <fieldset>
    <div class="label-block"><label for="credibility2">How credible is the source of the document?</label></div>
    Not Credible
    <input class="ranking" type="radio" name="credibility2" value="1" required>
    <input class="ranking" type="radio" name="credibility2" value="2" required>
    <input class="ranking" type="radio" name="credibility2" value="3" required>
    <input class="ranking" type="radio" name="credibility2" value="4" required>
    <input class="ranking" type="radio" name="credibility2" value="5" required>
    Very Credible
  </fieldset>

  <fieldset>
    <button id="stuccoSubmit2" class="pure-button pure-button-primary">Submit Ratings</button>
  </fieldset>

  </form>
  </div>

</div> <!-- end hidden -->

<div id="instruction-block">
  <div class="instructions">
    <p>Enter your email to generate a unique identification string.</p>
    <p>Your email is <strong>not</strong> stored, only the hash is used.</p>
  </div>
  <form class="pure-form">
    <fieldset>
      <br />
      <input id="email" class="pure-input-1-2" name="email" type="email" placeholder="email address" >
      <button id="createIdBtn" class="pure-button pure-button-primary" onclick="createId();return false;">Create ID</button>
    </fieldset>
  </form>
</div>

</div>

<script type="text/javascript">
var $ = function(id) { return document.getElementById(id); };
var hash;

function createId () {
  'use strict';
  var email = $('email').value
    , host = '//localhost/';  // 'stucco.aws.af.cm'
    
  hash = md5(email ? email : new Date().getTime());

  $('stuccoId').innerHTML = 'ID: &nbsp; ' + hash;
  $('instruction-block').style.display = 'none';

  addBookmarklet(hash, host);
  revealBookmarklet();
}

function addBookmarklet(hash, host) {
  var href = "javascript:javascript: (function () { var f = document.createElement('script'); f.innerHTML = 'var stuccoId = \"" + hash + "\"; var host = \"" + host + "\";'; document.body.appendChild(f); var e = document.createElement('script'); if (window.location.protocol === 'https:') { e.setAttribute('src', 'https:"+host+"modalForm.js'); } else { e.setAttribute('src', 'http:"+host+"modalForm.js'); } document.body.appendChild(e); })();";
  $('bookmarklet').setAttribute('href', href);
}

function revealBookmarklet() {
  $('initialHide').style.display = 'block';
}

function postJSON(loc, data) {
  var req = new XMLHttpRequest();
  req.open('POST', loc, true);
  req.setRequestHeader('Content-type', 'application/json');
  req.send(data);
  req.addEventListener('load', function() {
    console.log('successful POST');
  }, false);
  req.addEventListener('error', function() {
    postJSON('/error', JSON.stringify({msg: "error on POST"}));
  }, false);
}

function getRadioSelection(radioName) {
  var radios = document.getElementsByName(radioName);
  var value;
  for (var i = 0; i < radios.length; i++) {
    if (radios[i].type === 'radio' && radios[i].checked) {
      value = radios[i].value;       
    }
  }
  return value;
}
function getCheckboxSelection(name) {
  var checks = document.getElementsByName(name);
  var d = [];
  for (var i = 0; i < checks.length; i++) {
    if (checks[i].type === 'checkbox' && checks[i].checked) {
      d.push( checks[i].value );
    }
  }
  return d;
}

  document.getElementById('stuccoSubmit2')
    .addEventListener('click', processAndPost, false);

function processAndPost(e) {
  e.preventDefault();
  var d = processBackupForm();
  console.log(d);
  postJSON('/', JSON.stringify(d));
}

function processBackupForm() {
  return {
      url:          document.URL,
      date:         new Date(),
      relevance:    getRadioSelection('relevance2'),
      concept:      getCheckboxSelection('concept2'),
      credibility:  getRadioSelection('credibility2'),
      userid:       hash
    };
}

</script>
</body>
</html>
